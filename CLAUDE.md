# CLAUDE.md

このファイルは、Claude Code (claude.ai/code) がこのリポジトリで作業する際のガイダンスを提供します。

## 最重要ルール
### コミットメッセージとプルリクエストの記載ルール
- **コミットメッセージは日本語で記載する**
- **「Generated with Claude Code」や「Co-Authored-By: Claude」などのClaude関連の記載を含めない**

### 新しいルールの追加プロセス
- ユーザから今回限りでなく常に対応が必要だと思われる指示を受けた場合：
  1. 「これを標準のルールにしますか？」という質問する
  2. ユーザが「はい」を選択した場合、CLAUDE.md ファイルのルールを追加/修正する
  3. 以降、標準のルールとして扱う
- このプロセスにより、プロジェクトルールを継続的に改善していきましょう。

## プロジェクト概要

BlackSmith.Domain は、ゲームプロジェクト用の Unity ベースのドメインライブラリです。\
ドメイン駆動設計（DDD）の原則を実装し、ドメインロジックと Unity 固有の実装を分離したクリーンアーキテクチャを採用しています。

## アーキテクチャ

### コア構造
- **ドメイン層**: `Assets/Plugins/BlackSmith.Domain/Domain/` にあるコアビジネスロジック
- **ユースケース層**: `Assets/Plugins/BlackSmith.Domain/Usecase/` にあるアプリケーションロジック
- **テスト**: `Assets/Plugins/BlackSmith.Domain/Tests/` にある単体テスト

### 主要ドメイン領域
- **Character**: プレイヤーエンティティ、戦闘システム、装備管理
- **Items**: 装備品、クラフト可能アイテム、武器、NPC ショップ
- **Inventory**: 装備インベントリ、取引システム、ウォレットシステム
- **Field**: 4層構造の世界システム（World → Map → Field → Chunk）
- **Skills**: 戦闘スキル、生産スキル、パッシブ効果
- **Quest**: クエスト管理システム

### 依存関係
- **UniTask**: Unity 用の async/await サポート
- **R3**: リアクティブエクステンション
- **Newtonsoft.Json**: JSON シリアライゼーション
- **System.Collections.Immutable**: イミュータブルコレクション

## ビルドとテストコマンド

### Unity エディタ
- Unity エディタ（Unity 2023.2+）でプロジェクトを開く
- テストは Unity Test Runner ウィンドウから実行

### Visual Studio ソリューション
```bash
# ソリューションをビルド
dotnet build BlackSmith.Domain.sln

# 特定のプロジェクトをビルド
dotnet build BlackSmith.Domain.csproj
dotnet build BlackSmith.Domain.Test.csproj
```

### Unity Package Manager
プロジェクトは UPM パッケージとして配布されています：
- メイン: `https://github.com/Kojima-Tatsuki/BlackSmith.Domain.git?path=Assets/Plugins/BlackSmith.Domain`
- 開発版: `https://github.com/Kojima-Tatsuki/BlackSmith.Domain.git?path=Assets/Plugins/BlackSmith.Domain#develop`

## フィールドシステムアーキテクチャ

世界は4つの階層構造で構成されています：
1. **World（世界）**: 最上位エリア（1桁数を想定）
2. **Map（マップ）**: 世界内の国、山、平原
3. **Field（フィールド）**: マップ内の町、区画、ダンジョン（主要エリア単位）
4. **Chunk（チャンク）**: フィールド内のレンダリング/処理分割

## コーディング規約

- C# 9.0 言語機能を使用
- 参照型の null 許容性を有効化（`#nullable enable`）
- ドメインエンティティは値オブジェクトに record 型を使用（例: `BasicID`）
- エンティティ作成にファクトリーパターンを使用
- エンティティ再構築にコマンドパターンを使用
- データアクセスにリポジトリパターンを使用（ユースケース層のインターフェース）

## ドキュメント管理

### 基本方針
BlackSmith.Domainは**ゲームドメインライブラリ**であり、ドキュメントは以下の原則に従って作成・管理する：

1. **ライブラリ視点の記述**
   - ライブラリ利用者（ゲーム開発者）向けに記述する
   - 提供するAPI、ドメインサービス、ビジネスルールに焦点を当てる
   - ゲームプレイヤーの体験やUI/UXの詳細には言及しない

2. **具体性と抽象性のバランス**
   - アーキテクチャ文書は概念的な説明に特化
   - ドメイン文書は具体的な実装とコード例を含む
   - 実装詳細は適切なレベルのドキュメントに配置

### 記述ルール
- ドキュメントは**現在実装されている機能を主体として**記載する
- 未実装機能は「未実装～」「拡張ポイント」等の専用セクションで明示的に分離する
- 実装済み機能の説明内で未実装機能を言及することは禁止
- 未実装機能セクションでは「将来実装可能」「拡張予定」等の表現を使用可能
- 機能を実装した時点で、未実装セクションから実装済みセクションに移動する

#### 未実装機能記載の理由
BlackSmith.Domainは**ドメインライブラリ**として、利用者が機能の範囲、設計意図、実装計画を理解する必要があるため、専用セクションでの未実装機能記載を許可しています。

### 更新・保守ルール
- **機能変更時の更新**
  - 新機能追加・既存機能修正時は、必ず関連ドキュメントも更新する
  - ドキュメント更新は機能実装と同じコミットに含めるか、直後に行う
  - APIの変更がある場合は、使用例やサンプルコードも併せて更新する

- **構造の管理**
  - レガシードキュメントは残さず削除する
  - 同じ情報を複数箇所に記載せず、適切な場所に一度だけ記載する
  - ドキュメント構造を変更する場合は、古い構造を残さずクリーンに移行する
  - ドキュメント間の参照は常に最新の構造を反映する

### ドキュメント構成
- **docs/README.md**: ライブラリ概要とドキュメント構成ガイド
- **docs/Architecture.md**: ライブラリ全体の設計思想と構造
- **docs/domains/*.md**: 各ドメインの詳細実装とビジネスルール
- **docs/systems/*.md**: 複数ドメインを統合したドメインサービス仕様（What）
- **docs/integration/*.md**: ドメイン間の技術的連携方法（How）